#region Prolog


#@@IDENTIFIER=Copy PriceData from Denmark
#@@DEPENDENCY[View]=[PriceCube]->[Copy PriceData from Denmark (source) 1428594980482]
#@@DEPENDENCY[Subset]=[actvsbud]->[Copy PriceData from Denmark 1428594980498]
#@@DEPENDENCY[Subset]=[region]->[Copy PriceData from Denmark 1428594980514]
#@@DEPENDENCY[Subset]=[model]->[Copy PriceData from Denmark 1428594980529]
#@@DEPENDENCY[Subset]=[month]->[Copy PriceData from Denmark 1428594980545]
#@@DEPENDENCY[Dimension]=[}Copy PriceData from Denmark (source map actvsbud) 1428594980576]
#@@DEPENDENCY[Dimension]=[}Copy PriceData from Denmark (source map region) 1428594980592]
#@@DEPENDENCY[Dimension]=[}Copy PriceData from Denmark (target selection region) 1428594980607]
#@@DEPENDENCY[Cube]=[}Copy PriceData from Denmark (mapping cube region) 1428594980654]


OnMinorErrorDoItemSkip=0;
NumericGlobalVariable('DataMinorErrorCount');
MinorErrorLogMax=100;

#For use in generating per-run unique object names
uniqueRunSuffix = TM1User() | '.' | NumberToString( NOW );
#Check for illegal characters that may cause naming problems
stripChrs = '"'':/\=, *';
stripChr = SUBST(stripChrs, 1, 1);
stripChrs = DELET(stripChrs, 1, 1);
WHILE ( LONG(stripChr) > 0 );
  stripChrIdx = SCAN(stripChr, uniqueRunSuffix);
  WHILE ( stripChrIdx > 0 );
    uniqueRunSuffix = DELET(uniqueRunSuffix, stripChrIdx, 1);
    stripChrIdx = SCAN(stripChr, uniqueRunSuffix);
  END;
  stripChr = SUBST(stripChrs, 1, 1);
  stripChrs = DELET(stripChrs, 1, 1);
END;


#Create per-run Source View for this link process
varRunSrcViewName = '}TITmp.source.' | uniqueRunSuffix;
ViewCreate('PriceCube', varRunSrcViewName );
ViewRowDimensionSet('PriceCube', varRunSrcViewName, 'model', 1 );
IF ( (P1 @= '') );
  ViewSubsetAssign('PriceCube', varRunSrcViewName, 'model', 'Copy PriceData from Denmark 1428594980529' );
ELSEIF ( (SUBST( P1, 1, 7) @= 'subset:') );
  ViewSubsetAssign('PriceCube', varRunSrcViewName, 'model', SUBST( P1, 8, LONG(P1)) );
ELSEIF ( 1 = 1 );
  var1SourceViewSubset = varRunSrcViewName;
  SubsetCreate('model', var1SourceViewSubset );
  SubsetElementInsert('model', var1SourceViewSubset, P1, 1 );
  ViewSubsetAssign('PriceCube', varRunSrcViewName, 'model', var1SourceViewSubset );
ENDIF;
ViewRowDimensionSet('PriceCube', varRunSrcViewName, 'month', 2 );
IF ( (P2 @= '') );
  ViewSubsetAssign('PriceCube', varRunSrcViewName, 'month', 'Copy PriceData from Denmark 1428594980545' );
ELSEIF ( (SUBST( P2, 1, 7) @= 'subset:') );
  ViewSubsetAssign('PriceCube', varRunSrcViewName, 'month', SUBST( P2, 8, LONG(P2)) );
ELSEIF ( 1 = 1 );
  var2SourceViewSubset = varRunSrcViewName;
  SubsetCreate('month', var2SourceViewSubset );
  SubsetElementInsert('month', var2SourceViewSubset, P2, 1 );
  ViewSubsetAssign('PriceCube', varRunSrcViewName, 'month', var2SourceViewSubset );
ENDIF;
ViewRowDimensionSet('PriceCube', varRunSrcViewName, 'actvsbud', 3 );
ViewSubsetAssign('PriceCube', varRunSrcViewName, 'actvsbud', 'Copy PriceData from Denmark 1428594980498' );
ViewRowDimensionSet('PriceCube', varRunSrcViewName, 'region', 4 );
ViewSubsetAssign('PriceCube', varRunSrcViewName, 'region', 'Copy PriceData from Denmark 1428594980514' );
DatasourceCubeview = varRunSrcViewName;

ViewExtractSkipCalcsSet( 'PriceCube', varRunSrcViewName, 0 );
ViewExtractSkipRuleValuesSet( 'PriceCube', varRunSrcViewName, 0 );
ViewExtractSkipZeroesSet( 'PriceCube', varRunSrcViewName, 1 );
OldCubeLogChanges = CUBEGETLOGCHANGES('PriceCube');
CUBESETLOGCHANGES('PriceCube', 0);

#Process zero out view
varRunTgtViewName = '}TITmp.target.' | uniqueRunSuffix;
ViewCreate( 'PriceCube', varRunTgtViewName );
ViewRowDimensionSet( 'PriceCube', varRunTgtViewName, 'actvsbud', 1 );
ViewRowDimensionSet( 'PriceCube', varRunTgtViewName, 'region', 2 );
ViewRowDimensionSet( 'PriceCube', varRunTgtViewName, 'model', 3 );
ViewRowDimensionSet( 'PriceCube', varRunTgtViewName, 'month', 4 );
var1TargetViewSubset = varRunTgtViewName;
SubsetCreate( 'actvsbud', var1TargetViewSubset );
SubsetElementInsert( 'actvsbud', var1TargetViewSubset, 'Actual', 1 );
SubsetElementInsert( 'actvsbud', var1TargetViewSubset, 'Budget', 2 );
ViewSubsetAssign( 'PriceCube', varRunTgtViewName, 'actvsbud', var1TargetViewSubset );
var2TargetViewSubset = varRunTgtViewName;
SubsetCreate( 'region', var2TargetViewSubset );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Charles John', 1 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Shruti A Lalan', 2 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Shuchi Bajpai', 3 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'John Lyons', 4 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Peter Thomas1', 5 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Andrei Ionescu', 6 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Richard Reynolds', 7 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Daniel Sivret', 8 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Ehab Teima', 9 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'David Corbett', 10 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Newton S Sun', 11 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Sean McDowell', 12 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Yanyan Gao', 13 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Jeyanthy Ajanthan', 14 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Paul Glennon', 15 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Siong Wong', 16 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Julia Hurst', 17 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'George Campbell', 18 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Usman Hayat', 19 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Charbel Abou-Khalil', 20 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Mike Sadler', 21 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Joanne Maxwell', 22 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Dmytro Hyshtymult', 23 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Varun Sharma', 24 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Tom Shackell', 25 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Paulo Monte', 26 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Richard Rodgers', 27 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Soufiane Azizi', 28 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Georgy Lago', 29 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Pavle Kovacevic', 30 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Kathleen Ryder', 31 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Brian Hirsch', 32 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'James Williams2', 33 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Amanpreet Singh', 34 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'John Owen', 35 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Ian Aitken', 36 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Aaron Zhang', 37 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Jason Reich', 38 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Robert Penney', 39 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Debra Pesek', 40 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Kelly C Olson', 41 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Ralph Doran', 42 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Matthew Lachance', 43 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Dominic Leung', 44 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Ravi p Arneja', 45 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Ariel Paulin', 46 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Reid N Gifford', 47 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'Dave Brons', 48 );
SubsetElementInsert( 'region', var2TargetViewSubset, 'John Runions', 49 );
ViewSubsetAssign( 'PriceCube', varRunTgtViewName, 'region', var2TargetViewSubset );
var3TargetViewSubset = varRunTgtViewName;
IF ( (P1 @= '') );
  SubsetCreateByMDX( var3TargetViewSubset, 'FILTER( [model].MEMBERS, ISLEAF( [model].CURRENTMEMBER ) )' );
ELSEIF ( (SUBST( P1, 1, 7) @= 'subset:') );
  var3TargetViewSubset = SUBST( P1, 8, LONG(P1));
ELSEIF ( 1 = 1 );
  SubsetCreate('model', var3TargetViewSubset );
  SubsetElementInsert('model', var3TargetViewSubset, P1, 1 );
ENDIF;
ViewSubsetAssign( 'PriceCube', varRunTgtViewName, 'model', var3TargetViewSubset );
var4TargetViewSubset = varRunTgtViewName;
IF ( (P2 @= '') );
  SubsetCreateByMDX( var4TargetViewSubset, 'FILTER( [month].MEMBERS, ISLEAF( [month].CURRENTMEMBER ) )' );
ELSEIF ( (SUBST( P2, 1, 7) @= 'subset:') );
  var4TargetViewSubset = SUBST( P2, 8, LONG(P2));
ELSEIF ( 1 = 1 );
  SubsetCreate('month', var4TargetViewSubset );
  SubsetElementInsert('month', var4TargetViewSubset, P2, 1 );
ENDIF;
ViewSubsetAssign( 'PriceCube', varRunTgtViewName, 'month', var4TargetViewSubset );
ViewZeroOut( 'PriceCube', varRunTgtViewName );
ViewDestroy( 'PriceCube', varRunTgtViewName );
SubsetDestroy( 'actvsbud', var1TargetViewSubset );
SubsetDestroy( 'region', var2TargetViewSubset );
IF ( (P1 @= '')%(SUBST( P1, 1, 7) @<> 'subset:') );
  SubsetDestroy( 'model', var3TargetViewSubset );
ENDIF;
IF ( (P2 @= '')%(SUBST( P2, 1, 7) @<> 'subset:') );
  SubsetDestroy( 'month', var4TargetViewSubset );
ENDIF;

#endregion
#region Data


SkipUpdates=0;

IF ( (SkipUpdates<>1)&((DIMIX( '}Copy PriceData from Denmark (source map actvsbud) 1428594980576', VSOURCE_0 ) = 0)) );
  SkipUpdates=1;
ENDIF;
IF ( (SkipUpdates<>1)&((DIMIX( '}Copy PriceData from Denmark (source map region) 1428594980592', VSOURCE_1 ) = 0)) );
  SkipUpdates=1;
ENDIF;

IF ( (SkipUpdates<>1) );
  
  #process complex mappings
  Index_3=0;
  WHILE ( Index_3 < 49 );
    Index_3 = Index_3 + 1;
    VSOURCE_1_DERIVED=CellGetS( '}Copy PriceData from Denmark (mapping cube region) 1428594980654', VSOURCE_1, NumberToString(Index_3) );
    IF ( (VSOURCE_1_DERIVED @<> '') );
      
      #perform updates
      IF ( CellIsUpdateable( 'PriceCube', VSOURCE_0, VSOURCE_1_DERIVED, VSOURCE_2, VSOURCE_3 ) = 1 );
        IF ( VALUE_IS_STRING = 1 );
          CellPutS( SVALUE, 'PriceCube', VSOURCE_0, VSOURCE_1_DERIVED, VSOURCE_2, VSOURCE_3 );
        ELSEIF ( 1 = 1 );
          CellPutN( NVALUE, 'PriceCube', VSOURCE_0, VSOURCE_1_DERIVED, VSOURCE_2, VSOURCE_3 );
        ENDIF;
      ENDIF;
      
    ENDIF;
  END;
ENDIF;

#endregion
#region Epilog


#Destroy per-run Source View / Subset for this regular link process
ViewDestroy( 'PriceCube', varRunSrcViewName );
IF ( (P1 @<> '')&(SUBST( P1, 1, 7) @<> 'subset:') );
  SubsetDestroy('model', var1SourceViewSubset );
ENDIF;
IF ( (P2 @<> '')&(SUBST( P2, 1, 7) @<> 'subset:') );
  SubsetDestroy('month', var2SourceViewSubset );
ENDIF;
CUBESETLOGCHANGES('PriceCube', OldCubeLogChanges);
#endregion